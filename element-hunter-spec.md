# ELEMENT HUNTER 仕様書

## 概要

### コンセプト
実在のWebサイトがダンジョンになる2D探索アクションゲーム。
HTML要素が敵として出現し、倒すことで「図鑑」に収集される。
全HTML要素（約118種）のコンプリートが究極目標。

### インスピレーション
- ドルアーガの塔（探索・アイテム収集）
- ドラゴンバスター（戦闘・操作感）
- グラディウス（パワーアップシステム）
- ハクスラ系（テンポ・収集欲）

### ターゲットプラットフォーム
- ブラウザ（HTML5 Canvas / WebGL）
- キーボード操作（将来的にゲームパッド対応）

---

## ゲームルール

### マップ構造

```
1ページ = 1部屋
```

- **横幅（X）**: コンテンツ量に比例して可変
  - `横幅 = 基本幅 + (要素数 × 係数) + (文字数 ÷ 係数)`
  - 最小幅: 1画面分
  - 最大幅: 制限あり（要調整）
- **高さ（Y）**: 固定（1画面）
- **敵の配置**: DOM順に左から右へ配置（Y座標はランダム）

### 扉（部屋間移動）

| 配置 | リンク種別 | 条件 |
|------|-----------|------|
| 右端 | 深い階層へのリンク | `<main>`, `<article>`内のリンクのみ |
| 部屋内 | 同階層へのリンク | 同上 |
| 左端 | 親階層へ戻る | 常に1つ |
| 無視 | 共通リンク | `<nav>`, `<header>`, `<footer>`内、または出現率80%以上 |

### ゴール

- 各サイトの「最深階層」のページからランダムで1つ選ばれる
- そのページの右端扉に到達でクリア

---

## キャラクター

### プレイヤー

- **表示**: `▶`（向きで変化可）
- **HP**: 初期値（要調整、例: 5）
- **移動速度**: 固定（パワーアップで一時強化可）
- **攻撃**: 前方に剣（短距離）

### 敵（HTML要素）

敵はHTML要素のタグ名がそのまま表示される。

#### レアリティと強さ

| レアリティ | 色 | タグ例 | HP | 攻撃力 | 動き |
|-----------|-----|--------|-----|--------|------|
| ★☆☆☆☆ | 白 | `<p>`, `<span>`, `<div>`, `<a>`, `<li>`, `<img>` | 1-2 | 1 | 単純 |
| ★★☆☆☆ | 緑 | `<h6>`-`<h4>`, `<ul>`, `<table>`, `<form>`, `<button>`, `<input>` | 3-8 | 2-3 | 追尾・射撃 |
| ★★★☆☆ | 青 | `<h3>`-`<h1>`, `<article>`, `<section>`, `<video>`, `<audio>`, `<canvas>`, `<iframe>` | 7-15 | 4-6 | 追尾・特殊攻撃 |
| ★★★★☆ | 紫 | `<dialog>`, `<template>`, `<details>`, `<meter>`, `<progress>`, `<svg>`, `<picture>`, `<mark>` | 10-20 | 5-8 | 分身・透明化等 |
| ★★★★★ | 金（光る） | `<ruby>`, `<bdo>`, `<wbr>`, `<data>`, `<slot>`, `<output>` | 20-30 | 8-15 | 特殊能力持ち |

#### 動きパターン

| パターン | 対象タグ例 | 挙動 |
|----------|-----------|------|
| 往復 | `<p>` | 左右に往復、壁で反転 |
| ランダム | `<span>` | 不規則に方向転換 |
| 巡回 | `<div>` | 決まったルートを周回 |
| 編隊 | `<li>` | 複数が並んで動く |
| 射撃 | `<img>` | 停止して弾を撃つ |
| 追尾（遅） | `<table>` | ゆっくりプレイヤーを追う |
| 追尾（速） | `<h1>` | 積極的にプレイヤーを追う |

#### 倒した時

- 図鑑に登録される
- カプセルをドロップ（パワーアップゲージ+1）

### 障害物

HTML由来ではなく、汎用オブジェクト。

| 種類 | 表示 | 耐久 | ドロップ |
|------|------|------|----------|
| 箱 | `[箱]` | 1発 | ランダム |
| 樽 | `[樽]` | 1発 | ランダム |
| 岩 | `[岩]` | 2-3発 | 良いものが出やすい |
| クリスタル | `[◇]` | 1発 | カプセル確定 |

- **配置数**: コンテンツ量に比例（長いページほど多い）

#### ドロップテーブル（通常）

| 確率 | アイテム |
|------|----------|
| 60% | カプセル（ゲージ+1） |
| 25% | 回復（HP小回復） |
| 10% | 回復（HP中回復） |
| 5% | 空っぽ |

---

## パワーアップシステム

グラディウス式のゲージ制。

### ゲージ

```
[回復] → [攻撃UP] → [速度UP] → [無敵] → [全体攻撃]
  1個      2個        3個        4個        5個
```

- カプセル取得でゲージ+1
- ボタン2で現在位置の効果を発動、ゲージリセット
- **部屋をまたいでも維持**

### 各効果

| 位置 | 必要数 | 効果 | 持続 |
|------|--------|------|------|
| 1 | 1個 | HP小回復 | 即時 |
| 2 | 2個 | 攻撃力UP | 一定時間 |
| 3 | 3個 | 移動速度UP | 一定時間 |
| 4 | 4個 | 無敵 | 一定時間 |
| 5 | 5個 | 画面全体攻撃 | 即時 |

---

## 収集システム（図鑑）

### 収集方法

- 敵を倒すと、そのHTML要素が図鑑に登録される
- スルーすると収集できない

### 図鑑

- 全HTML要素（約118種）を収集
- レアリティ表示
- 収集率表示

### 称号（実績）

| 収集率 | 称号 |
|--------|------|
| 50% | HTML見習い |
| 70% | Web戦士 |
| 90% | DOM征服者 |
| 100% | HTMLマスター → 真エンディング |

---

## 操作

### キーボード

| キー | アクション |
|------|-----------|
| 矢印キー or WASD | 8方向移動 |
| Z or Space | 攻撃（剣） |
| X or Shift | パワーアップ発動 |
| ESC | ポーズ |

### 将来対応（ゲームパッド）

| 入力 | アクション |
|------|-----------|
| 十字キー/左スティック | 8方向移動 |
| ボタン1（A/○） | 攻撃 |
| ボタン2（B/×） | パワーアップ発動 |
| Start | ポーズ |

---

## ビジュアル

### 方針

テキストベースのミニマルデザイン。

### 表示例

```
┌─────────────────────────────────────────────────┐
│                                                 │
│  ▶     <p>  <p>     <div>      <h1>          🚪 │
│              <p>        <img>                   │
│     <span> <span>   [箱]            <table>     │
│                                                 │
│ ═══════════════════════════════════════════════ │
│  [♥♥♥♥♥]              [■■■□□]       STAGE: /   │
└─────────────────────────────────────────────────┘
```

### 要素の表示

| 要素 | 表示 | 備考 |
|------|------|------|
| プレイヤー | `▶` | 向きで `▲▼◀▶` |
| 敵 | `<tagname>` | レアリティで色変化 |
| 障害物 | `[名前]` | |
| 扉 | `🚪` or `[DOOR]` | |
| カプセル | `●` | |
| 回復 | `♥` | |

### 色（レアリティ）

| レアリティ | 色コード |
|-----------|----------|
| ★1 | `#FFFFFF`（白） |
| ★2 | `#00FF00`（緑） |
| ★3 | `#0088FF`（青） |
| ★4 | `#AA00FF`（紫） |
| ★5 | `#FFD700`（金）+ 点滅 |

---

## 技術仕様

### 技術スタック

| レイヤー | 技術 |
|----------|------|
| フレームワーク | Kaboom.js または Phaser 3 |
| 言語 | TypeScript推奨 |
| バンドラー | Vite |
| データ形式 | JSON |

### ディレクトリ構成（案）

```
element-hunter/
├── src/
│   ├── main.ts          # エントリーポイント
│   ├── scenes/
│   │   ├── title.ts     # タイトル画面
│   │   ├── select.ts    # サイト選択
│   │   ├── game.ts      # メインゲーム
│   │   └── collection.ts # 図鑑画面
│   ├── entities/
│   │   ├── player.ts
│   │   ├── enemy.ts
│   │   └── obstacle.ts
│   ├── systems/
│   │   ├── powerup.ts   # ゲージシステム
│   │   ├── collection.ts # 図鑑システム
│   │   └── room.ts      # 部屋生成
│   └── data/
│       └── elements.ts  # HTML要素定義
├── data/
│   └── sites/           # クロール済みサイトデータ
│       ├── tutorial.json
│       └── sample-corp.json
├── tools/
│   └── crawler/         # クロールツール
│       ├── crawl.ts
│       └── package.json
├── public/
├── index.html
├── package.json
└── vite.config.ts
```

### サイトデータ形式（JSON）

```json
{
  "siteId": "example-corp",
  "siteName": "Example株式会社",
  "pages": [
    {
      "path": "/",
      "depth": 0,
      "elements": [
        { "tag": "h1", "count": 1 },
        { "tag": "p", "count": 12 },
        { "tag": "div", "count": 45 },
        { "tag": "img", "count": 8 }
      ],
      "links": ["/about", "/products", "/contact"],
      "contentLength": 4500
    },
    {
      "path": "/products",
      "depth": 1,
      "elements": [...],
      "links": ["/", "/products/item-a", "/products/item-b"],
      "contentLength": 3200
    }
  ],
  "deepestPages": ["/products/item-a/detail"],
  "rareElements": ["video", "canvas"]
}
```

### クロールツール要件

- Puppeteer または Playwright 使用
- 入力: URL（トップページ）
- 出力: JSON（上記形式）
- 機能:
  - JSレンダリング後のDOMを取得
  - 内部リンクを再帰的にクロール
  - 深度制限（無限ループ防止）
  - 共通リンクの検出・除外

---

## MVP（Phase 1）

### 範囲

最小限の動くプロトタイプ。

#### 含むもの

- [x] 1部屋固定（ハードコードでOK）
- [x] プレイヤー移動（8方向）
- [x] 攻撃（前方に判定）
- [x] 敵3種（`<p>`, `<div>`, `<h1>`）
  - 各1パターンの動き
  - 倒すと消える
- [x] 右端にゴール（触れたらクリア表示）
- [x] HP表示（敵に当たるとダメージ）

#### 含まないもの

- 複数部屋・扉
- パワーアップゲージ
- 障害物
- 図鑑
- サイトデータ読み込み
- サウンド

### 完了条件

- ゲームが起動する
- プレイヤーを操作できる
- 敵が動いて、攻撃で倒せる
- 敵に当たるとダメージを受ける
- 右端でクリア表示が出る

---

## Phase 2（ゲームとして遊べる）

- JSON読み込み → 部屋生成
- 複数部屋 + 扉での移動
- パワーアップゲージ
- 障害物 + ドロップ
- HP + ダメージ演出
- サイト選択画面

---

## Phase 3（完成形）

- 図鑑システム
- 全敵パターン実装
- レア敵演出（BGM変化、画面効果）
- サウンド（BGM、SE）
- タイトル画面
- セーブ/ロード（図鑑データ）
- ゲームパッド対応

---

## 備考

### 法的考慮

- 事前クロールするサイトは許可を取るか、自作する
- 収集したデータはゲームにバンドルし、リアルタイムクロールはしない

### バランス調整

- HP、攻撃力、移動速度等の数値は仮
- プレイしながら調整

### 拡張案（将来）

- マルチプレイ（同じサイトを複数人で探索）
- タイムアタックモード
- デイリーチャレンジ（日替わりサイト）
- 外部リンク → 別サイトへワープ
